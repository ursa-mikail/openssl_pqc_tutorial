#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#include <openssl/evp.h>
#include <openssl/pem.h>
#include <openssl/err.h>
#include <openssl/core_names.h>
#include <openssl/params.h>
#include <openssl/ec.h>

static void hexdump(const char *label, const unsigned char *buf, size_t len) {
    printf("%s (%zu bytes): ", label, len);
    for (size_t i = 0; i < len; i++) printf("%02X", buf[i]);
    printf("\n");
}



static EVP_PKEY *generate_mlkem(unsigned char *type) {
 

    EVP_PKEY *pkey = NULL;

    EVP_PKEY_CTX *kctx = EVP_PKEY_CTX_new_from_name(NULL, type, NULL);


    EVP_PKEY_keygen_init(kctx);

    EVP_PKEY_keygen(kctx, &pkey);


 printf("Type: %s\n",type);

uint8_t pub[2592], priv[4896];
size_t priv_len, pub_len;


EVP_PKEY_get_octet_string_param(pkey, OSSL_PKEY_PARAM_PRIV_KEY,
                                priv, sizeof(priv), &priv_len);
EVP_PKEY_get_octet_string_param(pkey, OSSL_PKEY_PARAM_PUB_KEY,
                                pub, sizeof(pub), &pub_len);


printf("Private key length: {%d}\n",priv_len);

hexdump("Private key (truncated to 500 bytes):",priv,500);

printf("\nPublic key length: {%d}\n",pub_len);
hexdump("\nPublic key(truncated to 500 bytes):",pub,500);

    EVP_PKEY_CTX_free(kctx);
    return pkey;
}

int main(int argc, char** argv) {

unsigned int pbitsize=1024;
unsigned int qbitsize=224;

    ERR_load_crypto_strings();
    OpenSSL_add_all_algorithms();

    unsigned char *type="ML-KEM-768";

    if (argc > 1) type  =  argv[1];

    EVP_PKEY *mlkem = generate_mlkem(type);
 

    return EXIT_SUCCESS;
}

/*
Type: ML-KEM-1024
Private key length: {3168}
Private key (truncated to 500 bytes): (500 bytes): FAB8851914595F3309110A5C02113C9A7920F82A073DF2C410B0179E52CFD176A7892573A698601F87B3B3392B66D14C21C8CA73460721711EF380A84A3A92FE7CC4149C98B57C9CF94ABE9A68A4368512180A3D77F48F69F39F0B3A0791B8B982940E3281222BDC0FBFCACF6316927667C0F2767F34C5C2AE576FE184894BA5082BC15F4D8B542618B1E8D864893A5DE63697676B3C9A7C4861E88C7E7B842D29C90D4555DAD6B9F5B428D4B8ABE5B0A3497998F9A00F35C571874BC0472B1F4191468E99CBD9180B1299813435359834A783D0C4D184B10ED33D2D432A3D73BBBB672A96D91EFA8757F4F259B5D0AA2A57286DE55C2586B7A95923E7335D4A13605A5559C9F1BB8891743BB22592FB4DFB6BBCDBCA0EB587A648DAA9590618356C55A40261B1A765DA31833056CD4CE255143A201235004C7C4B5E03233B5979F76C3501A57F07AA46887C8A1AB267E5C543F9C2BB8A472FE0295729DAC9AC57CC90524E52B056A6BB85E32239B14807E2477402D1B2E150439B624FF9448C079A313C414EE6B37070BC4D18A2A104D02E15C4107529C8700A1CA9886E79DB6A524590BC3C6E957BBD0EA5CDB7ECA7DB776ECEC5991AE0905878C55A530AA0A3381C7A19046462B789B0A086BDE0D1463EB80EA0543908BB9A86C85AE9CB8C9545A549EC82DC3460D84C67D71ABC8A53C92B50

Public key length: {1568}

Public key(truncated to 500 bytes): (500 bytes): 2E314C1C094B46C69F362AB1A8B1682A482C1FDC27BFC66F92D56C242911D35108C1108CD1087C2B7222E4B7A039513FDECBBF6BB630D5C04B47534DE836B4DDF472BF64468EC938CB5CC97980822F447E59378A18C29590015825C0B92F5227740B93AFC5510DA76DA0924C1E6B3D08370064F77114ABCA0D2A19CD885640B52BD8078666C3B426D54738482360095A825CC34A8CAD19B8499F6B630C286E66DC39392B3745803656B0C3108630CAF1AD2BB44EA1F84D18A2AAD1685B4284C85B3B4BD2646E59C17FFF59A4688C9C72B5B8CFB76E9328A392B4025BDB3CB09208823B3DC9A9792FCC18880769340348CEAA41E2E004883B8ED2F07E27FC095C692CFDA810C1F61AD54A908A6B42F6E64F5D2572FA46C1A4723D2BCB7BCFC01F1FEAA5B6344A72C243F17521A670B75301A8BEB7903F7463A1760B51B224D56BC8B3577709E9743B365C4F1838FCD585F4355B99E759AC0235909A09A2E09C4DC0B3B973CC70A43DB4141F35999590707F316779472062B087087E78222AA8A81BF1C10C6C3A6DA896A2C255E3A28D23194E6CA1365B9A7E4DEBB237069BDD20267C55B816CA62A8D0CF61E318D4F209E414691E3605C2E7065A316DA654B2BE087C30D3A3797307CC2608CAF5BEB834665D268E40E6C8B01BC62B984E24E46726ACCBF53C79B678B644ECA7A0EBAB2E4465F802

*/